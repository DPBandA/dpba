<head>
    {% assign csp_nonce = site.time | date: "%s" %}
    <title>{{ page.title }}</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ page.description }}">

    <meta property="og:title" content="{{ page.title | escape }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    <meta property="og:description" content="{{ page.description | escape }}">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="fb:app_id" content="2253948921630190">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title | escape }}">
    <meta name="twitter:description" content="{{ page.description | escape }}">
    <meta name="twitter:image" content="{{ page.image | absolute_url }}">

    <meta name="impact-site-verification" value="1a44f2cd-cce0-444c-9623-fe6afb9ca24a">

    {% comment %}
    CSP Logic:
    - post-layout → NO CSP (Disqus)
    - contact page → CSP with Brevo + reCAPTCHA support
    - all other pages → strict CSP with nonce
    {% endcomment %}

    {% if page.layout != "post-layout" %}
    {% if page.permalink == "/contact" %}
    <!-- CSP: Contact page (Brevo + reCAPTCHA) -->
    <meta http-equiv="Content-Security-Policy"
          content="
          default-src 'self';

          script-src
          'self'
          'unsafe-inline'
          https://cdn.jsdelivr.net
          https://sibforms.com
          https://www.google.com
          https://www.gstatic.com
          https://accounts.google.com
          https://www.googletagmanager.com;

          style-src
          'self'
          'unsafe-inline'
          https://cdn.jsdelivr.net
          https://fonts.googleapis.com
          https://sibforms.com
          https://assets.brevo.com;

          font-src
          'self'
          https://fonts.gstatic.com
          https://cdn.jsdelivr.net
          https://assets.brevo.com;

          img-src
          'self'
          https:
          data:;

          connect-src
          'self'
          https://sibforms.com
          https://*.sibforms.com
          https://www.google.com;

          frame-src
          https://www.google.com
          https://www.youtube.com
          https://www.youtube-nocookie.com;

          form-action
          'self'
          https://*.sibforms.com;

          object-src 'none';
          base-uri 'self';
          frame-ancestors 'none';
          upgrade-insecure-requests;
          ">
    {% else %}
    <!-- CSP: Default strict pages -->
    <meta http-equiv="Content-Security-Policy"
          content="
          default-src 'self';
          script-src 'self' 'nonce-{{ csp_nonce }}' https://cdn.jsdelivr.net https://accounts.google.com https://www.googletagmanager.com https://www.youtube.com https://s.ytimg.com;
          style-src 'self' https://cdn.jsdelivr.net https://fonts.googleapis.com;
          font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com;
          img-src 'self' https: data:;
          connect-src 'self' https:;
          frame-src https://www.youtube.com https://www.youtube-nocookie.com;
          object-src 'none';
          base-uri 'self';
          frame-ancestors 'none';
          upgrade-insecure-requests;
          ">
    {% endif %}
    {% endif %}

    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy"
          content="camera=(), microphone=(), geolocation=(), payment=(), usb=()">

    <link rel="canonical" href="{{ page.url | absolute_url }}">
    <link rel="icon" href="/assets/media/logo.png" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap">

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          crossorigin="anonymous">

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
          crossorigin="anonymous">

    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- JWT Decode -->
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script nonce="{{ csp_nonce }}" async
            src="https://www.googletagmanager.com/gtag/js?id=G-FD8P1GKV0Z">
    </script>
    <script nonce="{{ csp_nonce }}">
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'G-FD8P1GKV0Z');
    </script>
</head>
